## Contents

Part 1. [Готовый докер](#part-1-ready-made-docker) \
Part 2. [ Операции с контейнером](#part-2-operations-with-container) \
Part 3. [Мини веб-сервер](#part-3-mini-web-server) \
Part 4. [Свой докер](#part-4-your-own-docker) \
Part 5. [Dockle](#part-5-dockle) \
Part 6. [Базовый Docker Compose](#part-6-basic-docker-compose)


## Part 1. Готовый докер

В качестве конечной цели своей небольшой практики ты сразу выбрал написание докер-образа для собственного веб-сервера, а потому в начале тебе нужно разобраться с уже готовым докер-образом для сервера.
Твой выбор пал на довольно простой nginx.

**== Task ==**

##### Возьми официальный докер-образ с nginx и выкачай его при помощи `docker pull`.
![part1_1.jpg](screenshots/Part1/1_1.jpg)

##### Проверь наличие докер-образа через `docker images`.
![part1_2.jpg](screenshots/Part1/1_2.jpg)

##### Запусти докер-образ через `docker run -d [image_id|repository]`.
##### Проверь, что образ запустился через `docker ps`.
![part1_3.jpg](screenshots/Part1/1_3.jpg)

##### Посмотри информацию о контейнере через `docker inspect [container_id|container_name]`.
![part1_4.jpg](screenshots/Part1/1_4.jpg)

##### По выводу команды определи и помести в отчёт размер контейнера, список замапленных портов и ip контейнера.
![part1_5.jpg](screenshots/Part1/1_5.jpg)

##### Останови докер контейнер через `docker stop [container_id|container_name]`.
![part1_6.jpg](screenshots/Part1/1_6.jpg)

##### Проверь, что контейнер остановился через `docker ps`.
![part1_7.jpg](screenshots/Part1/1_7.jpg)

##### Запусти докер с портами 80 и 443 в контейнере, замапленными на такие же порты на локальной машине, через команду 'run'.
![part1_8.jpg](screenshots/Part1/1_8.jpg)
![part1_9.jpg](screenshots/Part1/1_9.jpg)

##### Проверь, что в браузере по адресу localhost:80 доступна стартовая страница nginx.
![part1_10.jpg](screenshots/Part1/1_10.jpg)

##### Перезапусти докер контейнер через `docker restart [container_id|container_name]`.
##### Проверь любым способом, что контейнер запустился.
![part1_11.jpg](screenshots/Part1/1_11.jpg)


## Part 2.  Операции с контейнером

Докер-образ и контейнер готовы. Теперь можно покопаться в конфигурации nginx и отобразить статус страницы.

**== Задание ==**

##### Прочитай конфигурационный файл nginx.conf внутри докер контейнера через команду exec.
![part2_1.jpg](screenshots/Part2/2_1.jpg)

##### Cоздай на локальной машине файл nginx.conf.
##### Настрой в нем по пути /status отдачу страницы статуса сервера nginx.
![part2_2.jpg](screenshots/Part2/2_2.jpg)

##### Скопируй созданный файл nginx.conf внутрь докер-образа через команду 'docker cp'.
![part2_3.jpg](screenshots/Part2/2_3.jpg)

##### Перезапусти nginx внутри докер-образа через команду *exec*.
![part2_4.jpg](screenshots/Part2/2_4.jpg)

##### Проверь, что по адресу localhost:80/status отдается страничка со статусом сервера nginx.
![part2_5.jpg](screenshots/Part2/2_5.jpg)

##### Экспортируй контейнер в файл container.tar через команду export.
##### Останови контейнер.
![part2_6.jpg](screenshots/Part2/2_6.jpg)

##### Удали образ через  `docker rmi [image_id|repository]`не удаляя перед этим контейнеры.
![part2_7.jpg](screenshots/Part2/2_7.jpg)

##### Удали остановленный контейнер.
![part2_8.jpg](screenshots/Part2/2_8.jpg)

##### Импортируй контейнер обратно через команду import.
##### Запусти импортированный контейнер.
![part2_9.jpg](screenshots/Part2/2_9.jpg)

##### Проверь, что по адресу localhost:80/status отдается страничка со статусом сервера nginx.
![part2_11.jpg](screenshots/Part2/2_10.jpg)


## Part 3. Мини веб-сервер

Теперь стоит немного оторваться от докера, чтобы подготовиться к последнему этапу. Время написать свой сервер.

**== Задание ==**

##### Напиши мини-сервер на C и FastCgi, который будет возвращать простейшую страничку с надписью  `Hello World!`.
![part3_1.jpg](screenshots/Part3/3_1.jpg)

##### Напиши свой nginx.conf, который будет проксировать все запросы с 81 порта на 127.0.0.1:8080.
![part3_3.jpg](screenshots/Part3/3_2.jpg)

##### Положи файл nginx.conf по пути ./nginx/nginx.conf (это понадобится позже).
![part3_4.jpg](screenshots/Part3/3_3.jpg)
![part3_5.jpg](screenshots/Part3/3_4.jpg)

##### Запусти написанный мини-сервер через spawn-fcgi на порту 8080.
![part3_2.jpg](screenshots/Part3/3_5.jpg)

##### Проверь, что в браузере по localhost:81 отдается написанная тобой страничка.
![part3_6.jpg](screenshots/Part3/3_6.jpg)


## Part 4.  Свой докер

Теперь всё готово. Можно приступать к написанию докер-образа для созданного сервера.

**== Задание  ==**

*При написании докер-образа избегай множественных вызовов команд RUN*

#### 1) собирает исходники мини сервера на FastCgi из Части 3;
#### 2) запускает его на 8080 порту;
#### 3) копирует внутрь образа написанный ./nginx/nginx.conf;
#### 4) запускает nginx.
nginx можно установить внутрь докера самостоятельно, а можно воспользоваться готовым образом с nginx'ом, как базовым.
![part4_1.jpg](screenshots/Part4/4_1.jpg)

##### Собери написанный докер-образ через 'docker build' при этом указав имя и тег.
![part4_2.jpg](screenshots/Part4/4_2.jpg)

##### Проверь через docker images, что все собралось корректно.
![part4_3.jpg](screenshots/Part4/4_3.jpg)

##### Запусти собранный докер-образ с маппингом 81 порта на 80 на локальной машине и маппингом папки ./nginx внутрь контейнера по адресу, где лежат конфигурационные файлы nginx'а (см. Часть 2).
![part4_4.jpg](screenshots/Part4/4_4.jpg)
![part4_5.jpg](screenshots/Part4/4_5.jpg)

##### Проверь, что по localhost:80 доступна страничка написанного мини сервера.
![part4_6.jpg](screenshots/Part4/4_6.jpg)

##### Допиши в ./nginx/nginx.conf проксирование странички /status, по которой надо отдавать статус сервера nginx.
![part4_7.jpg](screenshots/Part4/4_7.jpg)

##### Перезапусти докер-образ.
![part4_8.jpg](screenshots/Part4/4_8.jpg)

Если всё сделано верно, то, после сохранения файла и перезапуска контейнера, конфигурационный файл внутри докер-образа должен обновиться самостоятельно без лишних действий.
##### Проверь, что теперь по localhost:80/status отдается страничка со статусом nginx
![part4_9.jpg](screenshots/Part4/4_9.jpg)

## Part 5. **Dockle**

После написания образа никогда не будет лишним проверить его на безопасность.

**== Задание  ==**

##### Просканируй образ из предыдущего задания через `dockle [image_id|repository]`.
![part5_1.jpg](screenshots/Part5/5_1.jpg)

##### Исправь образ так, чтобы при проверке через dockle не было ошибок и предупреждений.
![part5_2.jpg](screenshots/Part5/5_2.jpg)
![part5_3.jpg](screenshots/Part5/5_3.jpg)

Ошибка CIS-DI-0010 решается командой -ak NGINX_GPGKEYS -ak NGINX_GPGKEY_PATH

## Part 6. Базовый **Docker Compose**

Вот ты и закончил свою разминку. А хотя погоди...
Почему бы не поэкспериментировать с развёртыванием проекта, состоящего сразу из нескольких докер-образов?

**== Задание  ==**

##### Напиши файл *docker-compose.yml*, с помощью которого:
##### 1) Подними докер-контейнер из Части 5 (он должен работать в локальной сети, т. е. не нужно использовать инструкцию EXPOSE и мапить порты на локальную машину).

##### 2) Подними докер-контейнер с nginx, который будет проксировать все запросы с 8080 порта на 81 порт первого контейнера.
##### Замапь 8080 порт второго контейнера на 80 порт локальной машины.
##### Останови все запущенные контейнеры.
##### Cобери и запусти проект с помощью команд `docker-compose build` и `docker-compose up`.
![part6_1.jpg](screenshots/Part6/6_1.jpg)
![part6_2.jpg](screenshots/Part6/6_2.jpg)

##### Проверь, что в браузере по localhost:80 отдается написанная тобой страничка, как и ранее.
![part6_2.jpg](screenshots/Part6/6_3.jpg)
